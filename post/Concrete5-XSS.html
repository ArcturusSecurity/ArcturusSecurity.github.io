<!doctype html><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><title>Arcturus Labs / Concrete5 Reflected XSS</title><link rel=stylesheet href=/assets/style.css><link rel="shortcut icon" href=/favicon.ico type=image/x-icon><div id=wrapper><header><div><h1>Arcturus Labs</h1><div class=header-links><a href=/><h2 class=header-link>Home</h2></a><a href=/archive.html><h2 class=header-link>Archive</h2></a><a href=/about.html><h2 class=header-link>About</h2></a></div></div></header><div class=container><section id=main_content><article><h1>Concrete5 Reflected XSS</h1><h2>Posted by Rory M on Thursday, July 25 2019</h2><p>It’s fun working in this industry. I get paid to break things, like every day. What more could you want?<p>On a related note, I found myself on a test last week. The client was launching a website, wanted to make sure they weren’t missing anything hilariously obvious. Pretty standard stuff. We did happen to find them leaving a phpinfo file laying around, but that’s besides the point.<p>I discovered they’re using a CMS called ‘<a href=https://www.concrete5.org/>Concrete5</a>’. This was new to me; so, naturally, my ears pricked up. I discovered that it’s open source and actually in fairly wide use (<i>if their website is to be believed..</i>): <a href=/assets/img/concrete5_install_numbers.png><img src=/assets/img/concrete5_install_numbers.png alt="suspicious numbers" title="Suspicious numbers..."></a> I decided to dig in with some source code analysis.<p>Reading through source code can sometimes be quite a pleasant experience. This application is written in PHP. This was not one of those times. Wrapping my head around how requests are routed took me longer than I care to admit, but my trusty sidekicks ripgrep and <code class=highlighter-rouge>echo "&lt;!-- HERE -->";</code> saved my bacon. <a href=/assets/img/concrete5_ugh.png><img src=/assets/img/concrete5_ugh.png alt="suspicious numbers" title="Friends don't let friends use PHP"></a><p>So. I hacked together, printf-debugging style, some routing information. Got my head around how URLs pair up with Controllers and Views. I’ve not dug into Symfony much before and I hope never to again.<p>After figuring out how to match a URL request to a specific View, I started grepping for some basic <code class=highlighter-rouge>$_GET</code> stuff. It took me a good fifteen minutes to realise Symfony has it’s own wrappers for <code class=highlighter-rouge>$_GET</code>, <code class=highlighter-rouge>$_POST</code> and <code class=highlighter-rouge>$_REQUEST</code>, because REASONS. After adjusting my regex, in <a href=https://github.com/concrete5/concrete5/blob/3cb869cee58b1bfc4b53bb94f1560967c2ed5851/concrete/views/panels/page/preview_as/frame.php#L4>one of the views</a> I found this gem:<div class="language-php highlighter-rouge"><div class=highlight><pre class=highlight><code>[..]
src="<span class=cp>&lt;?=</span> <span class=nx>URL</span><span class=o>::</span><span class=na>to</span><span class=p>(</span><span class=s1>'/ccm/system/panels/page/preview_as_user/render'</span><span class=p>)</span> <span class=o>.</span> <span class=s1>'?&amp;cID='</span> <span class=o>.</span> <span class=nx>Request</span><span class=o>::</span><span class=na>request</span><span class=p>(</span><span class=s1>'cID'</span><span class=p>)</span> <span class=cp>?&gt;</span>
[..]
</code></pre></div></div><p>Which is a very basic reflected XSS. I spent a bit more time rooting around for an SQL injection or an auth bypass… but other jobs began to clamour for my attention. For fun, <a href=https://gist.github.com/roddux/cff56d502ce2a541269fd55a4ecd8da9>here is my printf-debugging patchset</a>.<p>If anyone finds another XSS with <code class=highlighter-rouge>rg 'Request::(post|get|request)\('</code> then I claim all credit and I want a share of the bounty.<p>Timeline:<br>Vegans offended: 26<br>Found: 12 July 2019<br>Reported on hackerone: 15 July 2019<br>Fixed: 17 July 2019<br>Bounty received: 0.00 GBP<br>Time wasted: a lot<br></article></section></div></div><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115180299-2"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
gtag("js",new Date());gtag("config","UA-115180299-2");</script>